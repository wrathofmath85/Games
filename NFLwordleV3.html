<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NFL Wordle Showdown — Results</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
  :root{
    --bg:#0b0e14; --panel:#11161f; --muted:#8ea0b4; --text:#e9eef5; --rule:#253043;
    --accent:#5dd0ff; --accent-ink:#052c3a; --ok:#3bd37f; --bad:#ff6b6b; --warn:#ffd166;
  }
  html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.4 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial;}
  .wrap{max-width:1100px;margin:22px auto;padding:0 14px;}

  /* SCOREBOARD */
  .scoreboard{
    display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:12px;
    background:linear-gradient(180deg,#0e131c 0%, #0d1522 100%);
    border:1px solid var(--rule);
    border-radius:16px;padding:14px 14px; box-shadow:0 8px 24px rgba(0,0,0,.25);
    max-width:860px;margin:0 auto;
  }
  .team{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:end;}
  .name{font-weight:900;letter-spacing:.5px;font-size:22px;text-transform:uppercase;line-height:1.1;}
  .score{
    font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    font-size:40px;background:#0a0f17;border:2px solid #1a263a;border-radius:12px;
    padding:4px 12px;min-width:80px;text-align:center;box-shadow:inset 0 0 0 2px #0a1828;
  }
  .center{ text-align:center;display:flex;flex-direction:column;align-items:center;gap:6px;min-width:210px }
  .label{font-size:11px;color:var(--muted);letter-spacing:.2px}
  .big{font-weight:900;font-size:13px;color:#cfeaff}
  .banner{font-weight:900;font-size:12px;background:var(--accent);color:var(--accent-ink);
    padding:4px 10px;border-radius:999px;letter-spacing:.5px}

  /* TABLES */
  .tables{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:18px}
  .side h3{margin:0 0 8px 0;font-size:16px;color:#e6f2ff;font-weight:900;letter-spacing:.3px}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  thead th{font-size:11px;color:var(--muted);font-weight:800;text-align:center;padding:0 4px 2px 4px}
  thead th:first-child{text-align:left;padding-left:8px}
  tbody td{
    background:var(--panel);
    border:1px solid var(--rule);
    padding:8px 6px;
    vertical-align:middle;
  }
  tbody tr td:first-child{border-radius:12px 0 0 12px}
  tbody tr td:last-child{border-radius:0 12px 12px 0}

  .roundLabel{
    width:54px;
    text-align:left;
    padding-left:10px;
    color:#cfeaff;
    font-weight:900;
    letter-spacing:.3px;
  }

  /* result boxes */
  .boxCell{ text-align:center; }
  .box{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:26px;height:26px;
    border-radius:7px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.06); /* default gray */
    font-weight:1000;
    line-height:1;
    user-select:none;
  }
  .ok{ background:rgba(59,211,127,.18); border-color:rgba(59,211,127,.45); }
  .bad{ background:rgba(255,107,107,.18); border-color:rgba(255,107,107,.45); }

  .arrow{
    margin-left:6px;
    font-weight:1000;
    color:var(--warn);
    font-size:14px;
  }

  .footer{margin:14px 0 0;color:var(--muted);font-size:12px;text-align:center}

  @media (max-width:900px){
    .tables{grid-template-columns:1fr}
    .scoreboard{grid-template-columns:1fr;gap:10px}
    .team{grid-template-columns:1fr auto}
    .center{min-width:auto}
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- SCOREBOARD -->
    <section class="scoreboard" id="scoreboard">
      <div class="team team-left">
        <div class="name" id="leftName">LEFT</div>
        <div class="score" id="leftScore">0</div>
      </div>
      <div class="center">
        <div class="label">NFL WORDLE</div>
        <div class="big">SHOWDOWN</div>
        <div class="banner">FIRST TO 5 WINS!</div>
      </div>
      <div class="team team-right">
        <div class="name" id="rightName" style="text-align:right">RIGHT</div>
        <div class="score" id="rightScore">0</div>
      </div>
    </section>

    <div class="tables">
      <!-- LEFT -->
      <section class="side">
        <h3 id="leftHeader">Left</h3>
        <table>
          <thead>
            <tr>
              <th style="text-align:left">Rnd</th>
              <th>Pick</th>
              <th>Conf</th>
              <th>Div</th>
              <th>Team</th>
              <th>Pos</th>
              <th>Age</th>
              <th>Pts</th>
            </tr>
          </thead>
          <tbody id="leftBody"></tbody>
        </table>
      </section>

      <!-- RIGHT -->
      <section class="side">
        <h3 id="rightHeader">Right</h3>
        <table>
          <thead>
            <tr>
              <th style="text-align:left">Rnd</th>
              <th>Pick</th>
              <th>Conf</th>
              <th>Div</th>
              <th>Team</th>
              <th>Pos</th>
              <th>Age</th>
              <th>Pts</th>
            </tr>
          </thead>
          <tbody id="rightBody"></tbody>
        </table>
      </section>
    </div>

    <div class="footer">Refresh to pull the latest CSV data.</div>
  </div>

<script>
/* ======= CONFIG ======= */
const CSV = {
  // Your “selections + looked-up attributes” sheet (the one in your screenshot)
  Selections: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7-NfeL-PNHti9NS4z2Rk_i1MRyNwcrF8yYTA6VzpvFcdg3j5KxHQp2SPltrkuhgNXB9Q3vE0iU75K/pub?gid=642123740&single=true&output=csv",

  // Official answer (kept from your existing site)
  CurrentSelection: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7-NfeL-PNHti9NS4z2Rk_i1MRyNwcrF8yYTA6VzpvFcdg3j5KxHQp2SPltrkuhgNXB9Q3vE0iU75K/pub?gid=2147341155&single=true&output=csv",

  // Scoreboard (wins)
  CurrentStandings: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7-NfeL-PNHti9NS4z2Rk_i1MRyNwcrF8yYTA6VzpvFcdg3j5KxHQp2SPltrkuhgNXB9Q3vE0iU75K/pub?gid=224409268&single=true&output=csv"
};

const ROUNDS = 5;

/* ======= HELPERS ======= */
const $ = (sel, root=document) => root.querySelector(sel);
const el = (tag, attrs={}) => {
  const n = document.createElement(tag);
  for (const [k,v] of Object.entries(attrs)) {
    if (k === "className") n.className = v;
    else if (k === "text") n.textContent = v;
    else n.setAttribute(k, v);
  }
  return n;
};
const norm = (s)=> (s==null ? "" : String(s).trim().replace(/\s+/g," ").toUpperCase());

function isBlankCell(v){
  const s = String(v ?? "").trim();
  return !s || s.toUpperCase() === "#N/A";
}
function parseNumber(x){
  if (x === null || x === undefined) return null;
  const s = String(x).trim();
  if (!s || s.toUpperCase() === "#N/A") return null;
  const n = Number(s.replace(/[, ]/g,""));
  return Number.isFinite(n) ? n : null;
}
function loadCSV(url, opts={}) {
  return new Promise((resolve,reject)=>{
    Papa.parse(url, { download:true, ...opts, complete: resolve, error: reject });
  });
}

/*
  Box rules requested:
  - If the pick hasn't been made yet => leave gray (no red/green)
  - For numeric columns (Age, Pts):
      * wrong => DO NOT color red; show only arrow (still keep the gray box)
      * right => color green (no arrow)
*/
function makeBox({color=null, arrowDir=null} = {}){
  const box = el("span",{className:"box"});
  if (color === "ok") box.classList.add("ok");
  if (color === "bad") box.classList.add("bad"); // (used only for non-numeric)
  if (arrowDir){
    const a = el("span",{className:"arrow", text: arrowDir === "up" ? "↑" : "↓"});
    const wrap = document.createElement("span");
    wrap.appendChild(box);
    wrap.appendChild(a);
    return wrap;
  }
  return box;
}

/* ======= PARSE YOUR SELECTIONS GRID (NO HEADERS) =======
   Layout expected (from your screenshot):
   Left:  A round, B Selection, C Position, D Age, E Points, F Conference, G Division, H Team
   Right: I header/name, J Selection, K Position, L Age, M Points, N Conference, O Division, P Team
*/
function extractPicksGrid(grid){
  const leftName  = (grid?.[0]?.[0] ?? "Left").toString().trim() || "Left";
  const rightName = (grid?.[0]?.[8] ?? "Right").toString().trim() || "Right";

  const left = [];
  const right = [];

  for (let r=1; r<=ROUNDS; r++){
    const row = grid[r] || [];

    left.push({
      round: row[0],
      Selection: row[1],
      Position:  row[2],
      Age:       row[3],
      Points:    row[4],
      Conference:row[5],
      Division:  row[6],
      Team:      row[7]
    });

    right.push({
      round: row[8],
      Selection: row[9],
      Position:  row[10],
      Age:       row[11],
      Points:    row[12],
      Conference:row[13],
      Division:  row[14],
      Team:      row[15]
    });
  }

  return { leftName, rightName, left, right };
}

function gradePick(pick, official){
  // Determine if this row is "made" — if no selection, treat as not made
  const made = !isBlankCell(pick.Selection);

  // For not-made picks: return all null so UI stays gray
  if (!made) {
    return {
      made:false,
      pick:null, conf:null, div:null, team:null, pos:null,
      age:{color:null, arrow:null},
      pts:{color:null, arrow:null}
    };
  }

  // Categorical: if we have a value, mark ok/bad
  const selOk  = norm(pick.Selection)  && (norm(pick.Selection)  === norm(official.Selection));
  const confOk = norm(pick.Conference) && (norm(pick.Conference) === norm(official.Conference));
  const divOk  = norm(pick.Division)   && (norm(pick.Division)   === norm(official.Division));
  const teamOk = norm(pick.Team)       && (norm(pick.Team)       === norm(official.Team));
  const posOk  = norm(pick.Position)   && (norm(pick.Position)   === norm(official.Position));

  // Numeric: arrows only when wrong; green when exact match
  const ageMine = parseNumber(pick.Age);
  const ageTruth= parseNumber(official.Age);
  let age = { color:null, arrow:null };
  if (ageMine!=null && ageTruth!=null){
    if (ageMine === ageTruth) age = { color:"ok", arrow:null };
    else age = { color:null, arrow: (ageTruth > ageMine ? "up" : "down") }; // NO red
  }

  const ptsMine = parseNumber(pick.Points);
  const ptsTruth= parseNumber(official.Points);
  let pts = { color:null, arrow:null };
  if (ptsMine!=null && ptsTruth!=null){
    if (ptsMine === ptsTruth) pts = { color:"ok", arrow:null };
    else pts = { color:null, arrow: (ptsTruth > ptsMine ? "up" : "down") }; // NO red
  }

  return {
    made:true,
    pick: selOk ? "ok" : "bad",
    conf: confOk ? "ok" : "bad",
    div:  divOk  ? "ok" : "bad",
    team: teamOk ? "ok" : "bad",
    pos:  posOk  ? "ok" : "bad",
    age,
    pts
  };
}

function renderSide(tbody, picks, official){
  tbody.innerHTML = "";

  for (let i=0; i<ROUNDS; i++){
    const p = picks[i] || {};
    const g = gradePick(p, official);

    const tr = document.createElement("tr");

    // Round label
    const tdR = el("td",{className:"roundLabel"});
    tdR.textContent = (i+1);
    tr.appendChild(tdR);

    const add = (node)=>{
      const td = el("td",{className:"boxCell"});
      td.appendChild(node);
      tr.appendChild(td);
    };

    // If not made => all gray boxes
    if (!g.made){
      add(makeBox()); add(makeBox()); add(makeBox()); add(makeBox()); add(makeBox()); add(makeBox()); add(makeBox());
      tbody.appendChild(tr);
      continue;
    }

    // Non-numeric: ok => green, bad => red
    add(makeBox({color:g.pick}));
    add(makeBox({color:g.conf}));
    add(makeBox({color:g.div}));
    add(makeBox({color:g.team}));
    add(makeBox({color:g.pos}));

    // Numeric: ok => green, wrong => gray + arrow only
    add(makeBox({color:g.age.color, arrowDir:g.age.arrow}));
    add(makeBox({color:g.pts.color, arrowDir:g.pts.arrow}));

    tbody.appendChild(tr);
  }
}

/* ======= BOOT ======= */
async function boot(){
  // 1) Load selections grid (your provided CSV)
  const selRes = await loadCSV(CSV.Selections, { header:false, dynamicTyping:false, skipEmptyLines:false });
  const grid = selRes.data || [];
  const { leftName, rightName, left, right } = extractPicksGrid(grid);

  // 2) Official answer (first data row)
  const offRes = await loadCSV(CSV.CurrentSelection, { header:true, dynamicTyping:false, skipEmptyLines:true });
  const r2 = (offRes.data || [])[0] || {};
  const official = {
    Selection:  r2.Selection ?? r2.Name ?? "",
    Conference: r2.Conference ?? "",
    Division:   r2.Division ?? "",
    Team:       r2.Team ?? "",
    Position:   r2.Position ?? "",
    Age:        r2.Age ?? "",
    Points:     r2.Points ?? r2["Fantasy Points"] ?? ""
  };

  // 3) Scoreboard (wins)
  const stRes = await loadCSV(CSV.CurrentStandings, { header:false, dynamicTyping:false, skipEmptyLines:false });
  const st = stRes.data || [];
  const sLeftName  = (st?.[0]?.[0] ?? leftName ?? "Left").toString();
  const sRightName = (st?.[0]?.[1] ?? rightName ?? "Right").toString();
  const leftScore  = (st?.[1]?.[0] ?? "0").toString();
  const rightScore = (st?.[1]?.[1] ?? "0").toString();

  // Names on scoreboard/headers (NOT in the tables)
  $("#leftName").textContent   = sLeftName;
  $("#rightName").textContent  = sRightName;
  $("#leftScore").textContent  = leftScore;
  $("#rightScore").textContent = rightScore;

  $("#leftHeader").textContent  = sLeftName;
  $("#rightHeader").textContent = sRightName;

  // 4) Render
  renderSide($("#leftBody"), left, official);
  renderSide($("#rightBody"), right, official);
}

boot().catch(err=>{
  console.error(err);
  alert("There was a problem loading the CSV data. Open DevTools Console for details.");
});
</script>
</body>
</html>
