<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NFL Wordle Showdown</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
  :root{
    --bg:#0b0e14; --panel:#11161f; --muted:#8ea0b4; --text:#e9eef5; --rule:#253043;
    --accent:#5dd0ff; --accent-ink:#052c3a; --ok:#3bd37f; --bad:#ff6b6b;
    --chip:#0e2e3a; --pill:#0d3a46;
    --warn:#ffd166;
  }
  html,body{margin:0;background:var(--bg);color:var(--text);font:16px/1.4 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial;}
  .wrap{max-width:1200px;margin:40px auto;padding:0 16px;}
  /* SCOREBOARD */
  .scoreboard{
    display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:16px;
    background:linear-gradient(180deg,#0e131c 0%, #0d1522 100%);border:1px solid var(--rule);
    border-radius:18px;padding:20px 16px; box-shadow:0 8px 24px rgba(0,0,0,.25);
  }
  .team{
    display:grid;grid-template-columns:1fr auto;gap:10px;align-items:end;
  }
  .name{font-weight:800;letter-spacing:.5px;font-size:28px;text-transform:uppercase;}
  .score{
    font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size:48px; background:#0a0f17;border:2px solid #1a263a;border-radius:12px;
    padding:6px 14px; min-width:90px;text-align:center; box-shadow:inset 0 0 0 2px #0a1828;
  }
  .center{
    text-align:center;display:flex;flex-direction:column;align-items:center;gap:6px;min-width:220px
  }
  .label{font-size:12px;color:var(--muted);letter-spacing:.2px}
  .big{font-weight:800;font-size:14px;color:#cfeaff}
  .banner{font-weight:900;font-size:14px;background:var(--accent);color:var(--accent-ink);
    padding:4px 10px;border-radius:999px;letter-spacing:.5px}
  /* TABLES */
  .tables{display:grid;grid-template-columns:1fr auto 1fr;gap:18px;margin-top:28px}
  .side h3{margin:0 0 10px 0;font-size:18px;color:#e6f2ff}
  .checkCol{display:flex;flex-direction:column;gap:26px;align-items:center;padding-top:62px}
  .pill{
    border:none;background:var(--pill);color:#d3f7ff;border:1px solid #1a3a43;cursor:pointer;
    padding:10px 18px;border-radius:999px;font-weight:700;min-width:92px;box-shadow:0 2px 0 #072129;
    transition:transform .06s ease, filter .12s ease;
  }
  .pill:hover{filter:brightness(1.08)}
  .pill:active{transform:translateY(1px)}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  thead th{
    font-size:12px;color:var(--muted);font-weight:700;text-align:left;padding:0 8px 2px 8px
  }
  tbody td{
    background:var(--panel);border:1px solid var(--rule);padding:8px 8px;vertical-align:middle
  }
  tbody tr td:first-child{border-radius:12px 0 0 12px}
  tbody tr td:last-child{border-radius:0 12px 12px 0}
  .nameCell{min-width:220px}
  .grid{display:grid;grid-template-columns:repeat(7,1fr)}
  input[type="text"].name-input{
    width:100%;background:#0d1522;color:var(--text);border:1px solid #1f2d45;border-radius:10px;
    padding:8px 10px;font-size:14px;outline:none
  }
  .readonly{
    display:block;background:#0b1220;border:1px solid #1f2d45;border-radius:10px;padding:8px;
    color:#dce8ff;min-height:18px;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis
  }
  .tag{display:inline-block;background:var(--chip);padding:2px 8px;border-radius:999px;color:#bfeaff;font-size:12px}
  .good{background:rgba(59,211,127,.1)!important;border-color:#1a3e2c!important}
  .bad{background:rgba(255,107,107,.1)!important;border-color:#4a1f21!important}
  .arrow{font-weight:900;margin-left:6px;color:var(--warn)}
  .note{margin:16px 0 6px 0;color:var(--muted);font-size:13px}
  .footer{margin:28px 0;color:var(--muted);font-size:12px;text-align:center}
  @media (max-width:1000px){
    .tables{grid-template-columns:1fr}
    .checkCol{flex-direction:row;gap:12px;justify-content:center;padding-top:0}
    .scoreboard{grid-template-columns:1fr;gap:8px}
    .center{min-width:0}
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- SCOREBOARD -->
    <section class="scoreboard" id="scoreboard">
      <div class="team team-left">
        <div class="name" id="leftName">LEFT</div>
        <div class="score" id="leftScore">0</div>
      </div>
      <div class="center">
        <div class="label">NFL WORDLE</div>
        <div class="big">SHOWDOWN</div>
        <div class="banner">FIRST TO 5 WINS!</div>
      </div>
      <div class="team team-right">
        <div class="name" id="rightName" style="text-align:right">RIGHT</div>
        <div class="score" id="rightScore">0</div>
      </div>
    </section>

    <!-- TABLES -->
    <div class="tables">
      <!-- LEFT SIDE -->
      <section class="side" id="leftSide">
        <h3 id="leftHeader">Left</h3>
        <div class="note"><span class="tag">Tip</span> Start typing in a name — the list filters as you type.</div>
        <table>
          <thead>
            <tr>
              <th>Name</th><th>Conference</th><th>Division</th><th>Team</th>
              <th>Position</th><th>Age</th><th>Fantasy Points</th>
            </tr>
          </thead>
          <tbody id="leftBody"></tbody>
        </table>
      </section>

      <!-- CHECK BUTTONS COLUMN -->
      <div class="checkCol" id="checkCol">
        <!-- buttons injected by JS -->
      </div>

      <!-- RIGHT SIDE -->
      <section class="side" id="rightSide">
        <h3 id="rightHeader">Right</h3>
        <div class="note" style="visibility:hidden">.</div>
        <table>
          <thead>
            <tr>
              <th>Name</th><th>Conference</th><th>Division</th><th>Team</th>
              <th>Position</th><th>Age</th><th>Fantasy Points</th>
            </tr>
          </thead>
          <tbody id="rightBody"></tbody>
        </table>
      </section>
    </div>

    <div class="footer">Data updates when you refresh the page.</div>
  </div>

  <!-- All logic lives here -->
  <script>
  /* ======= CONFIG: CSV SOURCES ======= */
  const CSV = {
    Data: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7-NfeL-PNHti9NS4z2Rk_i1MRyNwcrF8yYTA6VzpvFcdg3j5KxHQp2SPltrkuhgNXB9Q3vE0iU75K/pub?gid=0&single=true&output=csv",
    CurrentSelection: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7-NfeL-PNHti9NS4z2Rk_i1MRyNwcrF8yYTA6VzpvFcdg3j5KxHQp2SPltrkuhgNXB9Q3vE0iU75K/pub?gid=2147341155&single=true&output=csv",
    CurrentStandings: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7-NfeL-PNHti9NS4z2Rk_i1MRyNwcrF8yYTA6VzpvFcdg3j5KxHQp2SPltrkuhgNXB9Q3vE0iU75K/pub?gid=224409268&single=true&output=csv"
  };

  /* ======= GLOBAL STATE ======= */
  const ROUNDS = 5;
  const fields = ["Conference","Division","Team","Position","Age","Points"]; // canonical order
  let playersByName = new Map();    // name -> full record from Data
  let officialByRound = {};         // 1..5 -> official record from CurrentSelection
  let contestant = { left:{name:"Left",score:0}, right:{name:"Right",score:0} };

  /* ======= HELPERS ======= */
  const $ = (sel, root=document) => root.querySelector(sel);
  const el = (tag, attrs={}) => Object.assign(document.createElement(tag), attrs);

  function parseNumber(x){
    if (x === null || x === undefined) return null;
    const n = Number(String(x).toString().replace(/[, ]/g,""));
    return Number.isFinite(n) ? n : null;
  }

  function clearStyles(row){
    row.querySelectorAll("td").forEach(td=>{
      td.classList.remove("good","bad");
      const ar = td.querySelector(".arrow");
      if (ar) ar.remove();
    });
  }

  function decorateMismatch(td, direction){
    td.classList.add("bad");
    const span = el("span",{className:"arrow"});
    span.textContent = direction === "up" ? "↑" : "↓";
    td.appendChild(span);
  }

  function good(td){ td.classList.add("good"); }
  function bad(td){ td.classList.add("bad"); }

  /* ======= BUILD UI ROWS ======= */
  function buildRows(){
    const leftBody  = $("#leftBody");
    const rightBody = $("#rightBody");
    const makeRow = (side, round) => {
      const tr = el("tr",{dataset:{side, round}});
      // Name input with datalist
      const nameTd = el("td",{className:"nameCell"});
      const input  = el("input",{type:"text", className:"name-input", placeholder:`Round ${round} – start typing…`});
      input.setAttribute("list","players-list");
      input.dataset.side = side;
      input.dataset.round = round;
      // On pick, populate
      input.addEventListener("change", ()=>populateFromName(tr, input.value.trim()));
      nameTd.appendChild(input); tr.appendChild(nameTd);

      // Six readonly cells in order fields[]
      fields.forEach(f=>{
        const td = el("td");
        const div = el("div",{className:"readonly",dataset:{field:f.toLowerCase()}});
        td.appendChild(div); tr.appendChild(td);
      });
      return tr;
    };
    for(let r=1;r<=ROUNDS;r++){
      leftBody.appendChild(makeRow("left", r));
      rightBody.appendChild(makeRow("right", r));
    }

    // Build 5 Check buttons
    const checkCol = $("#checkCol"); checkCol.innerHTML = "";
    for(let r=1;r<=ROUNDS;r++){
      const btn = el("button",{className:"pill", textContent:`Check\nRound ${r}`});
      btn.style.whiteSpace="pre-line";
      btn.addEventListener("click",()=>checkRound(r));
      checkCol.appendChild(btn);
    }
  }

  /* ======= POPULATE CELLS WHEN NAME CHOSEN ======= */
  function populateFromName(tr, name){
    clearStyles(tr);
    const rec = playersByName.get(name);
    const cells = {
      conference: tr.querySelector('[data-field="conference"]'),
      division:   tr.querySelector('[data-field="division"]'),
      team:       tr.querySelector('[data-field="team"]'),
      position:   tr.querySelector('[data-field="position"]'),
      age:        tr.querySelector('[data-field="age"]'),
      points:     tr.querySelector('[data-field="points"]')
    };
    if(!rec){
      Object.values(cells).forEach(c=>c.textContent = "");
      return;
    }
    // Normalize keys from Data CSV
    cells.conference.textContent = rec.Conference ?? rec.conference ?? "";
    cells.division.textContent   = rec.Division ?? rec.division ?? "";
    cells.team.textContent       = rec.Team ?? rec.team ?? "";
    cells.position.textContent   = rec.Position ?? rec.position ?? "";
    cells.age.textContent        = rec.Age ?? rec.age ?? "";
    cells.points.textContent     = rec.Points ?? rec.points ?? rec["Fantasy Points"] ?? "";
  }

  /* ======= ROUND CHECKING ======= */
  function getRow(side, round){
    return document.querySelector(`tbody#${side}Body tr:nth-child(${round})`);
  }

  function valuesForRow(tr){
    const name = tr.querySelector(".name-input").value.trim();
    const v = {
      Name: name,
      Conference: tr.querySelector('[data-field="conference"]').textContent.trim(),
      Division:   tr.querySelector('[data-field="division"]').textContent.trim(),
      Team:       tr.querySelector('[data-field="team"]').textContent.trim(),
      Position:   tr.querySelector('[data-field="position"]').textContent.trim(),
      Age:        tr.querySelector('[data-field="age"]').textContent.trim(),
      Points:     tr.querySelector('[data-field="points"]').textContent.trim()
    };
    return v;
  }

  function gradeOne(tr, official){
    clearStyles(tr);
    const picked = valuesForRow(tr);

    // For categorical fields, exact match => green; else red.
    ["Conference","Division","Team","Position"].forEach(f=>{
      const td = tr.children[ fields.indexOf(f)+1 ]; // +1 because name is cell 0
      const div = td.querySelector(".readonly");
      if(!picked[f] || !official[f]) return; // nothing to grade
      if(String(picked[f]).toUpperCase() === String(official[f]).toUpperCase()) good(td);
      else bad(td);
    });

    // For Age and Points, red with arrow if mismatch
    [["Age","age"], ["Points","points"]].forEach(([F, keyLower])=>{
      const td  = tr.children[ fields.indexOf(F)+1 ];
      const mine = parseNumber(picked[F]); const truth = parseNumber(official[F]);
      if(truth==null || mine==null) return;
      if(mine === truth) good(td);
      else decorateMismatch(td, truth > mine ? "up" : "down");
    });

    return picked.Name && String(picked.Name).toUpperCase() === String(official.Selection ?? official.Name ?? "").toUpperCase();
  }

  function checkRound(round){
    const leftRow  = getRow("left", round);
    const rightRow = getRow("right", round);
    const official = officialByRound[round];
    if(!official){ alert("Official data for this round is not available yet."); return; }

    const leftCorrect  = gradeOne(leftRow, official);
    const rightCorrect = gradeOne(rightRow, official);

    if(leftCorrect && rightCorrect){
      alert("YOU ARE BOTH CORRECT");
    }else if(leftCorrect){
      alert(`${contestant.left.name.toUpperCase()} WINS`);
    }else if(rightCorrect){
      alert(`${contestant.right.name.toUpperCase()} WINS`);
    }
  }

  /* ======= LOAD CSVs ======= */
  function loadCSV(url, opts={}){
    return new Promise((resolve,reject)=>{
      Papa.parse(url, { download:true, ...opts,
        complete: (res)=> resolve(res),
        error: reject
      });
    });
  }

  async function boot(){
    buildRows();

    // 1) Load Data CSV (players)
    const playersRes = await loadCSV(CSV.Data, {header:true, dynamicTyping:false, skipEmptyLines:true});
    const rows = playersRes.data.filter(r=>r && r.Name);
    const datalist = el("datalist",{id:"players-list"});
    const names = new Set();
    rows.forEach(r=>{
      // Normalize some headers
      const record = {
        Name: r.Name ?? r["Player"] ?? "",
        Conference: r.Conference ?? r["Conf"] ?? "",
        Division: r.Division ?? "",
        Team: r.Team ?? "",
        Position: r.Position ?? r.Pos ?? "",
        Age: r.Age ?? "",
        Points: r.Points ?? r["Fantasy Points"] ?? r["FantasyPoints"] ?? ""
      };
      playersByName.set(record.Name, record);
      if(record.Name && !names.has(record.Name)){
        names.add(record.Name);
        datalist.appendChild(el("option",{value:record.Name}));
      }
    });
    document.body.appendChild(datalist);

    // 2) Build static rows now that datalist exists (already built)

    // 3) Load CurrentSelection (official answers per round)
    const officialRes = await loadCSV(CSV.CurrentSelection, {header:true, dynamicTyping:false, skipEmptyLines:true});
    // Expect columns like Selection, Position, Age, Points, Conference, Division, Team
    (officialRes.data||[]).forEach((r,idx)=>{
      const round = idx+1; if(round>ROUNDS) return;
      officialByRound[round] = {
        Selection: r.Selection ?? r.Name ?? "",
        Conference: r.Conference ?? "",
        Division: r.Division ?? "",
        Team: r.Team ?? "",
        Position: r.Position ?? "",
        Age: r.Age ?? "",
        Points: r.Points ?? r["Fantasy Points"] ?? ""
      };
    });

    // 4) Load CurrentStandings (just first two rows/columns)
    const standingsRes = await loadCSV(CSV.CurrentStandings, {header:false, dynamicTyping:false, skipEmptyLines:false});
    const grid = standingsRes.data;
    const leftName  = (grid?.[0]?.[0] ?? "Left").toString();
    const rightName = (grid?.[0]?.[1] ?? "Right").toString();
    const leftScore = grid?.[1]?.[0] ?? "0";
    const rightScore= grid?.[1]?.[1] ?? "0";
    contestant.left.name = leftName;
    contestant.right.name = rightName;
    contestant.left.score = leftScore;
    contestant.right.score = rightScore;

    // Paint the UI
    $("#leftName").textContent = leftName;
    $("#rightName").textContent = rightName;
    $("#leftScore").textContent = leftScore;
    $("#rightScore").textContent = rightScore;
    $("#leftHeader").textContent = leftName;
    $("#rightHeader").textContent = rightName;
  }

  // Start
  boot().catch(err=>{
    console.error(err);
    alert("There was a problem loading the data. Open the console for details.");
  });
  </script>
</body>
</html>
